<!DOCTYPE html>
<html lang="pt">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">
	<link href="css/font-awesome.min.css" rel="stylesheet">
	<link href="css/dropdown.min.css" rel="stylesheet" type="text/css" />
	<link href="css/jquery.fancybox.css" rel="stylesheet" type="text/css" />
	<link href="css/stylesa361.css?ver=2.3" rel="stylesheet" type="text/css" />
	<link href="css/beta-popup.css" rel="stylesheet" type="text/css" />
	<link rel="icon" href="img/favicon.png" sizes="16x16 32x32" type="image/jpg">
	
	<title>Reeduca Recicla</title>
</head>
<body>
	<!-- Inicio Cabeçalho -->
	<header>
		<nav class="navbar navbar-light bg-white active shadow p-3 mb-0 ">
			<div class="col-md-4">
				<a class="navbar-brand align-self-start" href="#">
					<img src="img/logo_lado.png" class="logoMargin" width="200" alt="">
				</a>
			</div>
			<div class="col-md-8">
				<ul class="nav marginHeader justify-content-end">
					<li class="nav-item">
						<a class="nav-link active grow efeitoTransicao" href="index.html">Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link grow efeitoTransicao" href="sobre.html">Sobre nós</a>
					</li>
					<li class="nav-item">
						<a class="nav-link grow efeitoTransicao" href="loja.html">Loja</a>
					</li>
					<li class="nav-item">
						<a class="nav-link grow efeitoTransicao" href="contato.html">Contato</a>
					</li>
					<li class="nav-item">
						<a class="nav-link grow efeitoTransicao" href="mapa.html">Mapa</a>
					</li>
					<li class="nav-item">
						<a class="nav-link grow efeitoTransicao" data-toggle="modal" data-target="#exampleModal"
						data-whatever="@mdo" href="#">Login</a>
					</li>
				</ul>
			</div>
		</nav>

		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Login</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form>
						<div class="form-group" class="form-inline">
							<label for="recipient-name" class="col-form-label">Usuário:</label>
							<input type="text" class="form-control" id="recipient-name">
							<div class="form-inline">
								<input type="checkbox" class="form-control" id="input-remember-user">
								<label class="col-form-label" id="label-remember-user"> Lembrar usuário</label>
							</div>
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">Senha:</label>
							<input type="password" class="form-control" id="password"></input>
							<a href="#">Esqueceu a senha?</a>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-success" data-dismiss="modal"
					id="btn-login">Acessar</button>
					<a class="btn btn-danger" data-toggle="modal" data-target="#exampleModalCadastro"
					data-whatever="@mdo" href="#">Ainda não tem cadastro?</a>
				</div>
			</div>
		</div>
		<div class="modal fade" id="exampleModalCadastro" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content-usuario">
					<div class="modal-header" class="bg-success">
						<h5 class="modal-title" id="exampleModalCadastro">Cadastro de Usuário:</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">Nome completo:</label>
								<input type="text" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">E-mail:</label>
								<input type="email" class="form-control" id="recipient-name"
								placeholder="email@email.com.br">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">Endereço:</label>
								<input type="text" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">Número:</label>
								<input type="number" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">Complemento:</label>
								<input type="text" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">CEP:</label>
								<input type="number" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">Cidade:</label>
								<input type="text" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">UF:</label>
								<input type="text" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="recipient-name" class="col-form-label">Usuário:</label>
								<input type="text" class="form-control" id="recipient-name">
							</div>
							<div class="form-group">
								<label for="message-text" class="col-form-label">Senha:</label>
								<input type="password" class="form-control" id="password"></input>
							</div>
							<div class="form-group">
								<label for="message-text" class="col-form-label">Repetir senha:</label>
								<input type="password" class="form-control" id="password"></input>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="submit" class="btn btn-success" id="btn-cadastro-usuario"
						data-dismiss="modal">Cadastrar</button>
					</div>
				</div>
			</div>
		</div>
	</header>
	<!-- fim cabeçalho -->
	<body>
		<!DOCTYPE html>
		<html>
		<head>
			<style>
			/* define a altura do mapa para 100% da tela descontando o tamanho do header */
			#map { height: calc(100% - 126px); }
		</style>
	</head>
	<body>
		<div id="map"></div>

		<div class="panel city_panel">
			<div class="city_head">
				<div class="photo">
					<a href="#" class="fit_size" data-tooltip="visao geral">
						<img src="img/id_1.jpg" alt="" />
					</a>
				</div>
				<div class="main_cityinfo">
					<div class="dropdown">
						<button class="btn btn-dark dropdown-toggle botao-pesquisa" type="button" data-toggle="dropdown"><span class="label" data-id="1">São Paulo</span><span class="caret"></span></button>
						<ul class="dropdown-menu lista-cidades">
							<li><a>Selecione a cidade</a></li>
						</ul>
					</div>
				</div>
				<a href="#" class="opensearch"></a>

				<!-- <div class="search_block"><form id="search_left" action="#"><input type="text" placeholder="Qual a sua cidade?" name="address" /><input type="submit" value="OK" style="display:none;" /><i class="ico icomarker"></i><i data-tooltip="Minha Localizacao" class="ico icohome"></i></form></div> -->
			</div>
			<div class="panel_body">
				<div class="panel_body_wrap">
					<div class="trash_type">
						<div class="trash_type_title">ESCOLHA O MATERIAL A SER RECICLADO:</div>
						<div class="type_item">
							<a href="#" data-id="1" style="background-image: url(img/trash/trash1.png);"></a>
							<span class="custom-tooltip">Papel</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="2" style="background-image: url(img/trash/trash2.png);"></a>
							<span class="custom-tooltip">Vidro</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="3" style="background-image: url(img/trash/trash3.png);"></a>
							<span class="custom-tooltip">Plástico</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="4" style="background-image: url(img/trash/trash4.png);"></a>
							<span class="custom-tooltip">Metal</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="5" style="background-image: url(img/trash/trash5.png);"></a>
							<span class="custom-tooltip">Roupas</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="6" style="background-image: url(img/trash/trash6.png);"></a>
							<span class="custom-tooltip">Celular</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="7" style="background-image: url(img/trash/trash7.png);"></a>
							<span class="custom-tooltip">Resíduos Perigosos</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="8" style="background-image: url(img/trash/trash8.png);"></a>
							<span class="custom-tooltip">Baterias</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="9" style="background-image: url(img/trash/trash9.png);"></a>
							<span class="custom-tooltip">Lampadas</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="10" style="background-image: url(img/trash/trash10.png);"></a>
							<span class="custom-tooltip">Eletrodomésticos</span>
						</div>
						<div class="type_item">
							<a href="#" data-id="11" style="background-image: url(img/trash/trash11.png);"></a>
							<span class="custom-tooltip">Tetra Pack</span>
						</div>
					</div>
				</div>	
			</div>
		</div>
		<footer>    
			<nav class="nav nav-fill rodape">
				<div class="col-md-2"> 
					<li class="footer-logo-size">
						<img src="img/logo_branco.png" width="200" alt="">
					</li>  
				</div>
				<div class="col-md-9">
					<ul class="nav marginFooter">                  
						<li class="nav-item" >
							<a class="nav-link active menu-footer" href="index.html">Home</a>
							<a class="nav-link active menu-footer" href="sobre.html">Sobre</a>
							<a class="nav-link active menu-footer" href="loja.html">Loja</a>
						</li>
						<li class="nav-item" >
							<a class="nav-link active menu-footer" href="mapa.html">Mapa</a>
							<a class="nav-link active menu-footer" href="FAQ.html">FAQ</a> 
						</li>
						<li class="nav-item">
							<a class="nav-link active menu-footer" href="contato.html">Contato</a>
						</li>

						<div class="col-md-2 text-primary div-icones" >
							<ul class="ul-icones-footer ">
								<li class="nav-link active icones-footer">
									<a href="https://twitter.com/reeducarecicla" target="_blank">
										<i class="fa fa-twitter text-white"> </i>   
									</a>
								</li>

								<li class="nav-link active icones-footer">
									<a href="https://facebook.com/reeducarecicla" target="_blank">
										<i class="fa fa-facebook text-white"> </i>
									</a>
								</li> 
								<li class=" nav-link active icones-footer">
									<a href="http://instagram.com/reeducarecicla" target="_blank">
										<i class="fa fa-instagram text-white"> </i>
									</a>
								</li>
							</ul>
						</div>
						<li class="nav-item newsletter">
							<label class="form-control newsletter-footer"> Assine nossa Newsletter!</label>                
							<div class="input-group newsletter-email">
								<input class="form-control" type="email" placeholder="email@email.com.br"> </input>
								<span class="input-group-btn "> 
									<button class="btn btn-success" class="btn-newsletter" type="submit">Assine agora</button>
								</span>
							</div>
						</li>
					</ul>
				</div>
			</nav> 

			<section class="container-fluid" id="foot5">
				<h4 class="text-center" id="footer-copyrights">Copyrights © 2019 ReeducaRecicla</h4>
			</section>
		</footer>

		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDottVHFaZukoZo_EvVv-jxbhOCpC1LMeY&callback=initMap"></script>
		<script src="js/jquery.js"></script>
		<script src="js/bootstrap.bundle.js"></script>
		<script src="js/bootstrap.bundle.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.fancybox.pack.js"></script>
		<script src="js/gmaps.js"></script> <!-- plugin para google maps api -->

		<script>

					//////////////////////////////////////////////////////////////////////////////////////////
					// Inicia o mapa informando o elemento, as coordenadas iniciais e algumas opções extras //
					//////////////////////////////////////////////////////////////////////////////////////////
					var zoomInicial = 5;
					var latitudeInicial = -20.347000;
					var longitudeInicial = -40.294000;
					var mapa = new gMaps('#map',latitudeInicial,longitudeInicial, { zoom : zoomInicial, scrollwheel : false, pretoebranco : false });

					/**
					 * Função a ser chamada sempre que houver necessidade de mudar os marcadores no mapa, ou seja, quando alguém mudar quais marcadores deseja ver
					 */
					 function atualizarMapa() {

						////////////////////////////////////////////////////////////////////////////////////////////////////////////
						// Percorre os ícones de objetos descartáveis para identificar quais estão ativos e obter o id de cada um //
						////////////////////////////////////////////////////////////////////////////////////////////////////////////
						let categoria = [];
						$('.trash_type .type_item a').each(function(){
							if( $(this).is('.active') ) categoria.push($(this).data('id'));
						});

						/////////////////////////
						// pega o id da cidade //
						/////////////////////////
						let cidade = $('button.botao-pesquisa span.label').data('id');

						//////////////////////////////////////////////////////////////
						// remove os marcadores do mapa antes de adicionar os novos //
						//////////////////////////////////////////////////////////////
						mapa.removerMarcadores();

						/**
						 * faz uma solicitação ajax para obter um json com os novos marcadores
						 * @param  [url] passa a url do arquivo que retorna o json com os parâmetros da cidade e categorias selecionadas
						 */
						 $.getJSON(`marcadores.php?cidade=${cidade}&categoria=${categoria}`).then(function(response){
							// por ser uma requisição com Promise, é necessário que o        👆 then()
							// tratamento do retorn o seja feito no método then()
							// que é executado quando a requisição é bem sucedida
							window.marcadores = response;

							///////////////////////////////////////////////////////////////////
							// se não encontrar nenhum marcador, reduz o zoom para o inicial //
							///////////////////////////////////////////////////////////////////
							if( window.marcadores.length == 0 ) {
								mapa.map.setZoom(zoomInicial);
								mapa.centralizarMapa(latitudeInicial, longitudeInicial);
							}

							else {
								for (var i = window.marcadores.length - 1; i >= 0; i--) {
									///////////////////////////////////////////////////////////////////////////////////////////////
									// para cada iteração com o vetor, chama a função addMarker() para inserir os pontos no mapa //
									///////////////////////////////////////////////////////////////////////////////////////////////
									mapa.addMarker({
										latitude : window.marcadores[i].latitude,
										longitude : window.marcadores[i].longitude,
										title : window.marcadores[i].nome,
										//////////////////////////////////////////////////////////////////////////////
										// 👇 aqui montamos o html que será exibido quando o usuário clicar no ponto //
										//////////////////////////////////////////////////////////////////////////////
										html : `
										<p><b>${window.marcadores[i].nome}</b></p>
										<p>${window.marcadores[i].endereco}</p>
										<p>${window.marcadores[i].telefone}</p>
										<p><a href="https://maps.google.com?saddr=Current+Location&daddr=${window.marcadores[i].latitude},${window.marcadores[i].longitude}" target="_blank" title="Clique nesse link para abrir o GPS">Abrir GPS</a></p>
										`,
									});
								}
								///////////////////////////////////////////////////////////////////////////////////////////////
								// por fim chama essa função para centralizar o mapa com base nos marcadores recém colocados //
								///////////////////////////////////////////////////////////////////////////////////////////////
								mapa.zoomParaAjustar();
							}
						});
						}

					/**
					 * função responsável por popular a lista de cidades com base em um json vindo por ajax
					 */
					 function atualizarCidades() {
					 	for (var i = 0; i < window.cidades.length; i++) {
					 		$('ul.lista-cidades').append(
					 			$('<li>').append(
					 				$('<a>')
					 				.text(window.cidades[i].nome)
									////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
									// é importante armazenar também a imagem e id para ser possível alterar a imagem ao mudar a cidade e para o ajax que obtém os marcadores //
									////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
									.data('imagem', window.cidades[i].imagem)
									.data('id', window.cidades[i].id)
									)
					 			);
					 	}
					 }

					 //////////////////////////////////////////////////////////////////////////////////////////////////////
					 // adiciona função de click nos ícones para adicionar uma classe de active neles e atualizar o mapa //
					 //////////////////////////////////////////////////////////////////////////////////////////////////////
					 $('.trash_type .type_item a').on('click', function(event) {
					 	event.preventDefault();
					 	if( this.className == '' ) $(this).addClass('active');
					 	else $(this).removeClass('active');
					 	atualizarMapa();
					 });

					 ///////////////////////////////////////////////////////////////////////
					 // faz uma consulta ajax para obter um json com os nomes das cidades //
					 ///////////////////////////////////////////////////////////////////////
					 $.getJSON('cidades.php').then(function(response){
					 	window.cidades = response;
					 	atualizarCidades();
					 });

					 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
					 // adiciona uma função de click nas cidades para atualizar o nome, a foto e o id para ser pego posteriormente na função atualizarMapa() //
					 //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
					 $('ul.lista-cidades').on('click', 'li a', function(){
					 	$('button.botao-pesquisa span.label')
					 	.text( $(this).text() )
					 	.data('id', $(this).data('id')); /*👈 importante para a função atualizarMapa()*/
					 	$('.city_head .photo img').attr('src',  $(this).data('imagem'));
					 });
					</script>

				</body>
				</html>
